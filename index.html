<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Calorie & Meal Planner</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .app-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        .app-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .form-group { margin-bottom: 20px; }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #e1e5e9;
        }
        .btn-secondary:hover { background: #e9ecef; }
        .hidden { display: none; }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .meal-card {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        .meal-day {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            color: #333;
        }
        .meal-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .recipe-link {
            background: #ff6b6b;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s;
        }
        .recipe-link:hover { background: #ee5a24; }
        .calories-display {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }
        .budget-display {
            background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
        }
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .app-header h1 { font-size: 2rem; }
            .card { padding: 20px; }
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="app-header">
            <h1>üçΩÔ∏è Smart Calorie & Meal Planner</h1>
            <p>Your personalized nutrition and meal planning assistant</p>
        </div>

        <button class="logout-btn hidden" onclick="logout()">Logout</button>

        <!-- Login/Register Screen -->
        <div id="auth-screen" class="card">
            <h2>Welcome! Please Login or Create Account</h2>
            <div style="background: #fff7e6; color: #b36b00; border-left: 5px solid #ffae42; padding: 12px 18px; border-radius: 8px; margin-bottom: 18px; font-size: 1rem;">
                <strong>Security Notice:</strong>
                <br>
                This sign-in is for convenience only. <u>Do NOT use any real or sensitive passwords or PINs.</u><br>
                Your PIN and info are stored in your browser and are not securely encrypted. This design is intentional to avoid risks in case of a data breach.
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="email" placeholder="e.g., johnsmith@example.com" autocomplete="username">
            </div>
            <div class="form-group">
                <label>4-Digit PIN</label>
                <input type="password" id="pin" placeholder="e.g., 1234" maxlength="4" pattern="\d{4}" inputmode="numeric" autocomplete="current-password">
            </div>
            <button class="btn btn-primary" onclick="login()" style="width: 100%; margin-bottom: 10px;">Login</button>
            <button class="btn btn-secondary" onclick="register()" style="width: 100%;">Create New Account</button>
        </div>

        <!-- Main App -->
        <div id="main-app" class="hidden">
            <!-- User Info Form -->
            <div id="user-form" class="card">
                <h2>Your Information</h2>
                <div class="grid">
                    <div>
                        <div class="form-group">
                            <label>Age</label>
                            <input type="number" id="age" min="1" max="120">
                        </div>
                        <div class="form-group">
                            <label>Units</label>
                            <select id="units" onchange="updateUnits()">
                                <option value="metric">Metric (cm/kg)</option>
                                <option value="imperial">Imperial (ft/in/lbs)</option>
                            </select>
                        </div>
                        <div id="height-metric" class="form-group">
                            <label>Height (cm)</label>
                            <input type="number" id="height-cm" min="100" max="250" placeholder="e.g., 175">
                        </div>
                        <div id="height-imperial" class="form-group hidden">
                            <label>Height</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="number" id="height-ft" min="3" max="8" placeholder="Feet" style="flex: 1;">
                                <input type="number" id="height-in" min="0" max="11" placeholder="Inches" style="flex: 1;">
                            </div>
                        </div>
                        <div id="weight-metric" class="form-group">
                            <label>Weight (kg)</label>
                            <input type="number" id="weight-kg" min="30" max="300" placeholder="e.g., 70">
                        </div>
                        <div id="weight-imperial" class="form-group hidden">
                            <label>Weight (lbs)</label>
                            <input type="number" id="weight-lbs" min="66" max="660" placeholder="e.g., 154">
                        </div>
                        <div class="form-group">
                            <label>Gender</label>
                            <select id="gender">
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>Activity Level</label>
                            <select id="activity">
                                <option value="1.2">Sedentary (little/no exercise)</option>
                                <option value="1.375">Light (light exercise 1-3 days/week)</option>
                                <option value="1.55">Moderate (moderate exercise 3-5 days/week)</option>
                                <option value="1.725">Active (hard exercise 6-7 days/week)</option>
                                <option value="1.9">Very Active (very hard exercise, physical job)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Goal</label>
                            <select id="goal">
                                <option value="maintain">Maintain Weight</option>
                                <option value="lose">Lose Weight</option>
                                <option value="gain">Gain Weight</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Weekly Food Budget ($)</label>
                            <input type="number" id="budget" min="20" max="500" value="75">
                        </div>
                        <div class="form-group">
                            <label>Food Allergies/Intolerances (comma-separated)</label>
                            <textarea id="allergies" placeholder="e.g., nuts, dairy, gluten" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="calculateAndPlan()" style="width: 100%;">Generate My Meal Plan</button>
            </div>

            <!-- Results -->
            <div id="results" class="hidden">
                <div class="calories-display">
                    <h3>Your Daily Calorie Target</h3>
                    <div id="calorie-result" style="font-size: 2rem; font-weight: bold; margin: 10px 0;"></div>
                    <div id="goal-description"></div>
                </div>

                <div class="budget-display">
                    <h3>Weekly Budget Breakdown</h3>
                    <div id="budget-breakdown"></div>
                </div>

                <div id="meal-plan"></div>

                <button class="btn btn-secondary" onclick="showForm()" style="margin-top: 20px;">Update Information</button>
            </div>
        </div>
    </div>

    <script>
        // Sample meal database with recipes and detailed nutrition
        const meals = {
            breakfast: [
                { name: "Basic Oatmeal", calories: 280, price: 1.20, allergies: ["gluten"], protein: 8, carbs: 54, fat: 3, fiber: 8 },
                { name: "Scrambled Eggs", calories: 200, price: 1.80, allergies: [], protein: 14, carbs: 2, fat: 15, fiber: 0 },
                { name: "Toast with Jam", calories: 220, price: 1.50, allergies: ["gluten"], protein: 6, carbs: 42, fat: 3, fiber: 3 },
                { name: "Greek Yogurt", calories: 150, price: 2.00, allergies: ["dairy"], protein: 15, carbs: 8, fat: 8, fiber: 0 },
                { name: "Banana Pancakes", calories: 400, price: 2.80, allergies: ["gluten", "dairy"], protein: 12, carbs: 65, fat: 12, fiber: 4 }
            ],
            lunch: [
                { name: "Rice and Beans", calories: 380, price: 3.50, allergies: [], protein: 15, carbs: 68, fat: 4, fiber: 12 },
                { name: "Grilled Cheese", calories: 350, price: 3.80, allergies: ["gluten", "dairy"], protein: 16, carbs: 28, fat: 20, fiber: 2 },
                { name: "Chicken Rice Bowl", calories: 480, price: 6.20, allergies: [], protein: 35, carbs: 52, fat: 12, fiber: 3 },
                { name: "Lentil Soup", calories: 280, price: 4.20, allergies: [], protein: 18, carbs: 48, fat: 2, fiber: 16 }
            ],
            dinner: [
                { name: "Spaghetti with Marinara", calories: 420, price: 4.50, allergies: ["gluten"], protein: 15, carbs: 78, fat: 6, fiber: 8 },
                { name: "Chicken and Rice", calories: 520, price: 6.80, allergies: [], protein: 38, carbs: 55, fat: 14, fiber: 2 },
                { name: "Baked Chicken Thighs", calories: 480, price: 5.50, allergies: [], protein: 42, carbs: 8, fat: 30, fiber: 2 },
                { name: "Turkey Meatballs", calories: 450, price: 6.80, allergies: [], protein: 35, carbs: 24, fat: 24, fiber: 3 }
            ],
            snacks: [
                { name: "Apple", calories: 80, price: 0.75, allergies: [], protein: 0, carbs: 21, fat: 0, fiber: 4 },
                { name: "Banana", calories: 90, price: 0.50, allergies: [], protein: 1, carbs: 23, fat: 0, fiber: 3 },
                { name: "Carrots with Hummus", calories: 120, price: 2.00, allergies: [], protein: 4, carbs: 16, fat: 5, fiber: 6 },
                { name: "String Cheese", calories: 80, price: 1.00, allergies: ["dairy"], protein: 7, carbs: 1, fat: 6, fiber: 0 }
            ]
        };

        let currentUser = null;
        let users = {};

        function initializeStorage() {
            if (typeof Storage !== "undefined") {
                try {
                    const storedUsers = localStorage.getItem('mealPlannerUsers');
                    if (storedUsers) {
                        users = JSON.parse(storedUsers);
                    }
                } catch (error) {
                    console.warn('localStorage not available, using in-memory storage');
                    users = {};
                }
            }
        }

        function saveUsers() {
            if (typeof Storage !== "undefined") {
                try {
                    localStorage.setItem('mealPlannerUsers', JSON.stringify(users));
                } catch (error) {
                    console.warn('Cannot save to localStorage, data will not persist');
                }
            }
        }

        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function validatePin(pin) {
            return /^\d{4}$/.test(pin);
        }

        function login() {
            const email = document.getElementById('email').value.trim().toLowerCase();
            const pin = document.getElementById('pin').value.trim();
            if (!validateEmail(email)) {
                alert('Please enter a valid email address');
                return;
            }
            if (!validatePin(pin)) {
                alert('Please enter a 4-digit PIN');
                return;
            }
            if (users[email] && users[email].pin === pin) {
                currentUser = email;
                showMainApp();
                loadUserData();
            } else {
                alert('Invalid email or PIN');
            }
        }

        function register() {
            const email = document.getElementById('email').value.trim().toLowerCase();
            const pin = document.getElementById('pin').value.trim();
            if (!validateEmail(email)) {
                alert('Please enter a valid email address');
                return;
            }
            if (!validatePin(pin)) {
                alert('PIN must be exactly 4 digits (numbers only)');
                return;
            }
            if (users[email]) {
                alert('An account with this email already exists');
                return;
            }
            users[email] = { pin: pin, data: {} };
            saveUsers();
            currentUser = email;
            showMainApp();
        }

        function logout() {
            currentUser = null;
            document.getElementById('auth-screen').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
            document.querySelector('.logout-btn').classList.add('hidden');
            document.getElementById('email').value = '';
            document.getElementById('pin').value = '';
        }

        function showMainApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.querySelector('.logout-btn').classList.remove('hidden');
        }

        function updateUnits() {
            const units = document.getElementById('units').value;
            if (units === 'metric') {
                document.getElementById('height-metric').classList.remove('hidden');
                document.getElementById('height-imperial').classList.add('hidden');
                document.getElementById('weight-metric').classList.remove('hidden');
                document.getElementById('weight-imperial').classList.add('hidden');
            } else {
                document.getElementById('height-metric').classList.add('hidden');
                document.getElementById('height-imperial').classList.remove('hidden');
                document.getElementById('weight-metric').classList.add('hidden');
                document.getElementById('weight-imperial').classList.remove('hidden');
            }
        }

        function convertToMetric() {
            const units = document.getElementById('units').value;
            let height, weight;
            if (units === 'metric') {
                height = parseFloat(document.getElementById('height-cm').value);
                weight = parseFloat(document.getElementById('weight-kg').value);
            } else {
                const feet = parseFloat(document.getElementById('height-ft').value) || 0;
                const inches = parseFloat(document.getElementById('height-in').value) || 0;
                height = (feet * 12 + inches) * 2.54;
                weight = parseFloat(document.getElementById('weight-lbs').value) * 0.453592;
            }
            return { height, weight };
        }

        function loadUserData() {
            if (!currentUser || !users[currentUser]) return;
            const userData = users[currentUser].data;
            if (userData.age) {
                document.getElementById('age').value = userData.age;
                document.getElementById('gender').value = userData.gender;
                document.getElementById('activity').value = userData.activity;
                document.getElementById('goal').value = userData.goal;
                document.getElementById('budget').value = userData.budget;
                document.getElementById('allergies').value = userData.allergies;
                if (userData.units) {
                    document.getElementById('units').value = userData.units;
                    updateUnits();
                    if (userData.units === 'metric') {
                        document.getElementById('height-cm').value = userData.height;
                        document.getElementById('weight-kg').value = userData.weight;
                    } else {
                        document.getElementById('height-ft').value = userData.heightFt;
                        document.getElementById('height-in').value = userData.heightIn;
                        document.getElementById('weight-lbs').value = userData.weight;
                    }
                }
                if (userData.hasResults) {
                    calculateAndPlan();
                }
            }
        }

        function saveUserData() {
            if (!currentUser) return;
            const units = document.getElementById('units').value;
            const { height, weight } = convertToMetric();
            const userData = {
                age: document.getElementById('age').value,
                height: height,
                weight: weight,
                gender: document.getElementById('gender').value,
                activity: document.getElementById('activity').value,
                goal: document.getElementById('goal').value,
                budget: document.getElementById('budget').value,
                allergies: document.getElementById('allergies').value,
                units: units,
                hasResults: true
            };
            if (units === 'imperial') {
                userData.heightFt = document.getElementById('height-ft').value;
                userData.heightIn = document.getElementById('height-in').value;
                userData.weightLbs = document.getElementById('weight-lbs').value;
            }
            users[currentUser].data = userData;
            saveUsers();
        }

        function calculateCalories() {
            const age = parseInt(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            const activity = parseFloat(document.getElementById('activity').value);
            const goal = document.getElementById('goal').value;
            const { height, weight } = convertToMetric();
            if (!age || !height || !weight) {
                alert('Please fill in all required fields');
                return null;
            }
            let bmr;
            if (gender === 'male') {
                bmr = 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age);
            } else {
                bmr = 447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age);
            }
            let tdee = bmr * activity;
            if (goal === 'lose') {
                tdee -= 500;
            } else if (goal === 'gain') {
                tdee += 300;
            }
            return Math.round(tdee);
        }

        function filterMealsByAllergies(mealList, allergies) {
            if (!allergies || allergies.length === 0) return mealList;
            const allergyList = allergies.toLowerCase().split(',').map(a => a.trim());
            return mealList.filter(meal => {
                return !meal.allergies.some(allergen =>
                    allergyList.some(userAllergy =>
                        allergen.toLowerCase().includes(userAllergy) ||
                        userAllergy.includes(allergen.toLowerCase())
                    )
                );
            });
        }

        function generateMealPlan(targetCalories, weeklyBudget, allergies) {
            const dailyBudget = weeklyBudget / 7;
            const plan = [];
            const safeBreakfast = filterMealsByAllergies(meals.breakfast, allergies);
            const safeLunch = filterMealsByAllergies(meals.lunch, allergies);
            const safeDinner = filterMealsByAllergies(meals.dinner, allergies);
            const safeSnacks = filterMealsByAllergies(meals.snacks, allergies);

            safeBreakfast.sort((a, b) => a.price - b.price);
            safeLunch.sort((a, b) => a.price - b.price);
            safeDinner.sort((a, b) => a.price - b.price);
            safeSnacks.sort((a, b) => a.price - b.price);

            for (let day = 1; day <= 7; day++) {
                let dayCalories = 0;
                let dayBudget = 0;
                const dayMeals = [];
                let remainingBudget = dailyBudget;

                const affordableBreakfast = safeBreakfast.filter(meal => meal.price <= remainingBudget);
                if (affordableBreakfast.length === 0 && safeBreakfast.length > 0) {
                    const breakfast = safeBreakfast[0];
                    dayMeals.push({type: 'Breakfast', ...breakfast});
                    dayCalories += breakfast.calories;
                    dayBudget += breakfast.price;
                    remainingBudget -= breakfast.price;
                } else if (affordableBreakfast.length > 0) {
                    const breakfast = affordableBreakfast[Math.floor(Math.random() * Math.min(3, affordableBreakfast.length))];
                    dayMeals.push({type: 'Breakfast', ...breakfast});
                    dayCalories += breakfast.calories;
                    dayBudget += breakfast.price;
                    remainingBudget -= breakfast.price;
                }

                const affordableLunch = safeLunch.filter(meal => meal.price <= remainingBudget);
                if (affordableLunch.length === 0 && safeLunch.length > 0) {
                    const lunch = safeLunch[0];
                    dayMeals.push({type: 'Lunch', ...lunch});
                    dayCalories += lunch.calories;
                    dayBudget += lunch.price;
                    remainingBudget -= lunch.price;
                } else if (affordableLunch.length > 0) {
                    const lunch = affordableLunch[Math.floor(Math.random() * Math.min(3, affordableLunch.length))];
                    dayMeals.push({type: 'Lunch', ...lunch});
                    dayCalories += lunch.calories;
                    dayBudget += lunch.price;
                    remainingBudget -= lunch.price;
                }

                const affordableDinner = safeDinner.filter(meal => meal.price <= remainingBudget);
                if (affordableDinner.length === 0 && safeDinner.length > 0) {
                    const dinner = safeDinner[0];
                    dayMeals.push({type: 'Dinner', ...dinner});
                    dayCalories += dinner.calories;
                    dayBudget += dinner.price;
                    remainingBudget -= dinner.price;
                } else if (affordableDinner.length > 0) {
                    const dinner = affordableDinner[Math.floor(Math.random() * Math.min(3, affordableDinner.length))];
                    dayMeals.push({type: 'Dinner', ...dinner});
                    dayCalories += dinner.calories;
                    dayBudget += dinner.price;
                    remainingBudget -= dinner.price;
                }

                if (dayCalories < targetCalories - 150 && remainingBudget > 1.50) {
                    const affordableSnacks = safeSnacks.filter(snack => snack.price <= remainingBudget);
                    if (affordableSnacks.length > 0) {
                        const snack = affordableSnacks[Math.floor(Math.random() * affordableSnacks.length)];
                        dayMeals.push({type: 'Snack', ...snack});
                        dayCalories += snack.calories;
                        dayBudget += snack.price;
                        remainingBudget -= snack.price;
                    }
                }

                plan.push({
                    day: day,
                    meals: dayMeals,
                    totalCalories: dayCalories,
                    totalCost: dayBudget,
                    remainingBudget: Math.max(0, remainingBudget)
                });
            }
            return plan;
        }

        function calculateAndPlan() {
            const targetCalories = calculateCalories();
            if (!targetCalories) return;
            const weeklyBudget = parseFloat(document.getElementById('budget').value);
            const allergies = document.getElementById('allergies').value;
            const goal = document.getElementById('goal').value;
            saveUserData();
            document.getElementById('calorie-result').textContent = targetCalories + ' calories/day';
            let goalText = '';
            if (goal === 'maintain') goalText = 'Maintain your current weight';
            else if (goal === 'lose') goalText = 'Lose 1-2 pounds per week';
            else if (goal === 'gain') goalText = 'Gain 0.5-1 pounds per week';
            document.getElementById('goal-description').textContent = goalText;
            const mealPlan = generateMealPlan(targetCalories, weeklyBudget, allergies);
            const totalWeeklyCost = mealPlan.reduce((sum, day) => sum + day.totalCost, 0);
            const totalSavings = mealPlan.reduce((sum, day) => sum + day.remainingBudget, 0);
            document.getElementById('budget-breakdown').innerHTML = `
                <div style="font-size: 1.5rem; font-weight: bold; color: #27ae60;">${totalWeeklyCost.toFixed(2)} / week</div>
                <div>Your Budget: ${weeklyBudget.toFixed(2)} | Average: ${(totalWeeklyCost/7).toFixed(2)} per day</div>
                <div style="color: #27ae60; font-weight: bold;">
                    ‚úÖ Within Budget! Saved: ${(weeklyBudget - totalWeeklyCost).toFixed(2)}
                </div>
                <div style="margin-top: 10px; font-size: 14px; color: #666;">
                    üí° Meals selected to fit your ${weeklyBudget} weekly budget
                </div>
            `;
            let mealPlanHTML = '<h3>Your 7-Day Meal Plan</h3>';
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            mealPlan.forEach((day, index) => {
                mealPlanHTML += `
                    <div class="meal-day">
                        <h4>${days[index]} - ${day.totalCalories} calories - ${day.totalCost.toFixed(2)}
                        ${day.remainingBudget > 0 ? ` (Saved: ${day.remainingBudget.toFixed(2)})` : ''}</h4>
                        ${day.meals.map(meal => `
                            <div class="meal-item">
                                <div>
                                    <strong>${meal.type}:</strong> ${meal.name}<br>
                                    <small>${meal.calories} calories - ${meal.price.toFixed(2)}</small>
                                </div>
                                <a href="https://www.pinterest.com/search/pins/?q=${encodeURIComponent(meal.name + ' recipe')}" 
                                   target="_blank" class="recipe-link">Recipe</a>
                            </div>
                        `).join('')}
                    </div>
                `;
            });
            document.getElementById('meal-plan').innerHTML = mealPlanHTML;
            document.getElementById('user-form').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');
        }

        function showForm() {
            document.getElementById('user-form').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
        }

        window.onload = function() { initializeStorage(); };
    </script>
</body>
</html>
